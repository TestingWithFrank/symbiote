// Generated by CoffeeScript 1.3.3
(function() {
  var createViewLoader, fetchViewHeirarchy, requestSnapshotRefresh, snapshotUrlForView;

  fetchViewHeirarchy = function() {
    var request;
    return request = $.ajax({
      type: "POST",
      dataType: "json",
      data: '["DUMMY"]',
      url: symbiote.baseUrlFor("/dump")
    });
  };

  requestSnapshotRefresh = function() {
    return $.ajax({
      type: 'GET',
      url: symbiote.baseUrlFor("/screenshot/snapshot-all-views")
    });
  };

  snapshotUrlForView = function(view) {
    return symbiote.baseUrlFor("/screenshot/view-snapshot/" + view.uid + "?" + ((new Date()).getTime()));
  };

  createViewLoader = function(ui) {
    var processView, processViewPlusSubviews, update;
    processView = function(view, depth) {
      return ui.addViewSnapshot({
        src: snapshotUrlForView(view),
        depth: depth,
        frame: view.accessibilityFrame
      });
    };
    processViewPlusSubviews = function(view, depth) {
      var subview, _i, _len, _ref, _results;
      processView(view, depth);
      _ref = view.subviews;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        subview = _ref[_i];
        _results.push(processViewPlusSubviews(subview, depth + 1));
      }
      return _results;
    };
    update = function() {
      return $.when(requestSnapshotRefresh(), fetchViewHeirarchy()).done(function(_, viewHeirResponse) {
        var viewHeir;
        viewHeir = viewHeirResponse[0];
        return processViewPlusSubviews(viewHeir, 0);
      });
    };
    return {
      update: update
    };
  };

  symbiote.createViewLoader = createViewLoader;

}).call(this);
